(()=>{const t=[300,100,300,100,300,100,300],e=[200,100,200,100,200],n=[150,50,150],i=[100,50,100],a=[];self.addEventListener("push",o=>{if(!o.data)return;let s;try{s=o.data.json()}catch(t){s={title:"SafetyAlerts",body:o.data.text()||"New alert in your area"}}const r=function(o){var s,r;if(!1===o.vibrate)return a;const l=(null===(s=o.data)||void 0===s?void 0:s.broadcast_type)||o.type||"normal",c=(null===(r=o.data)||void 0===r?void 0:r.incident_type)||"";return"emergency"===l?t:["robbery","kidnapping","gunshots","attack"].includes(c)?e:"broadcast"===l||"info"===l||"announcement"===l?i:n}(s),l={body:s.body||"New safety alert in your area",icon:"/icons/icon-192.png",badge:"/icons/icon-72.png",vibrate:r,tag:s.tag||`safety-alert-${Date.now()}`,renotify:!0,requireInteraction:!1!==s.requireInteraction,silent:0===r.length,data:{url:s.url||"/app",alertId:s.alertId,type:s.type||"alert"},actions:[{action:"view",title:"View Alert"},{action:"dismiss",title:"Dismiss"}]};o.waitUntil(self.registration.showNotification(s.title||"SafetyAlerts",l))}),self.addEventListener("notificationclick",t=>{t.notification.close();const e=t.action,n=t.notification.data||{},i=n.url||"/app";"dismiss"!==e&&t.waitUntil(clients.matchAll({type:"window",includeUncontrolled:!0}).then(t=>{for(const e of t)if(e.url.includes("/app")&&"focus"in e)return e.postMessage({type:"NOTIFICATION_CLICKED",alertId:n.alertId}),e.focus();if(clients.openWindow)return clients.openWindow(i)}))}),self.addEventListener("notificationclose",t=>{console.log("Notification dismissed:",t.notification.tag)}),self.addEventListener("sync",t=>{"sync-reports"===t.tag&&t.waitUntil(async function(){console.log("Syncing pending reports...")}())}),self.addEventListener("message",t=>{t.data&&"SKIP_WAITING"===t.data.type&&self.skipWaiting()}),console.log("SafetyAlerts service worker loaded")})();